# T-1189-Driver by compromise-恶意投放攻击（水坑攻击）

## 模块简介

恶意投放攻击是指攻击者通过用户在正常浏览过程中访问恶意网站来获得对系统的访问权限。使用此技术，通常会将用户的Web浏览器作为攻击目标，但攻击者也可能会将受侵害的网站用于非利用行为，例如获取应用程序访问令牌。

存在多种将漏洞利用代码传递给浏览器的方法，包括：

- 攻击者注入了某种形式的恶意代码（例如JavaScript，iFrame和跨站点脚本）的合法网站就受到了威胁。
- 恶意广告是通过合法广告提供商付费并投放的。
- 内置的Web应用程序界面可用于插入任何其他类型的对象，这些对象可用于显示Web内容或包含在来访客户端上执行的脚本（例如，论坛帖子，评论和其他用户可控制的Web内容）。

对手使用的网站通常是特定社区（例如政府，特定行业或地区）访问的网站，其目标是基于共同利益来折衷特定用户或一组用户。这种有针对性的攻击被称为战略性网络入侵或水坑攻击。有几种已知的例子。

典型的恶意投放过程：

1. 用户访问用于托管对手受控内容的网站。
2. 脚本会自动执行，通常会在浏览器和插件的版本中搜索可能存在漏洞的版本。
   - 可能要求用户通过启用脚本或活动的网站组件并忽略警告对话框来协助此过程。
3. 找到易受攻击的版本后，漏洞利用代码将传递到浏览器。
4. 如果利用成功，那么除非有其他保护措施，否则它将使对手代码在用户的系统上执行。
   - 在某些情况下，在提供漏洞利用代码之前，需要在初始扫描后再次访问网站。

攻击者还可能使用受感染的网站来将用引导到在窃取 OAuth令牌（例如OAuth令牌）的应用程序的恶意应用程序，以获取对受保护的应用程序和信息的访问权限。这些恶意应用程序是通过合法网站上的弹出窗口传递的。

## 检测思路

由于该攻击方式主要为用户主动访问恶意网站， 所以被攻击主体为类似Web浏览器、Wget、Curl等访问工具，故检测思路主要在浏览器是否安全配置、访问工具版本是否存在第三方漏洞和用户行为审计。

### 应急操作

#### 补救方面

1. 更新浏览器
2. 开启浏览器的安全配置

#### 排查方面

1. 获取浏览器版本
2. 查看浏览器历史记录
3. 查看相关用户行为管理安全产品日志
4. 使用流量监听产品进行流量捕获

### 排查工具

#### 流量类

wireshark、Tcpdump

#### 历史记录类

用系统自带软件即可

### 工具操作说明

dpkg（ubuntu）

```
dpkg -l | grep "packagename"
```

rpm（centos）

```
rpm -qa | grep "packagename"
```

history

```
history | grep "wget"
cat /homr/username/.bash_history | grep -E 'wget|curl'
cat /var/log/audit/audit.log |grep 'wget|curl'
```

### 相关案例

暂无